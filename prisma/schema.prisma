generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// === MODEL PENGGUNA (ID String Manual: AC0001) ===
model Pengguna {
  id_pengguna     String            @id @db.VarChar(20) // Bukan UUID lagi
  nama_lengkap    String            @db.VarChar(100)
  email           String?           @unique @db.VarChar(150)
  nomor_telepon   String?           @unique @db.VarChar(20)
  kata_sandi      String?           @db.VarChar(255)
  google_id       String?           @unique @db.VarChar(100)
  kota_asal       String?           @db.VarChar(50)
  tanggal_lahir   DateTime?         @db.Date
  jenis_kelamin   gender_enum?
  foto_profil_url String?
  peran           peran_enum?       @default(USER)
  status_akun     status_akun_enum? @default(AKTIF)
  wa_terverifikasi Boolean?         @default(false)
  kode_referral   String?           @unique @db.VarChar(20)
  login_terakhir  DateTime?         @db.Timestamp(6)
  dibuat_pada     DateTime?         @default(now()) @db.Timestamp(6)
  diperbarui_pada DateTime?         @default(now()) @updatedAt @db.Timestamp(6)
  
  // Relasi
  agent           agent?

  @@index([kode_referral], map: "idx_kode_referral")
  @@index([email], map: "idx_pengguna_email")
  @@map("pengguna")
}

// === MODEL AGENT (ID String Manual: AG0001) ===
model agent {
  id_agent           String             @id @db.VarChar(20)
  id_pengguna        String             @unique(map: "agent_id_pengguna_unique") @db.VarChar(20)
  
  // KOLOM kode_agent SUDAH DIHAPUS DISINI
  
  nama_kantor        String             @db.VarChar(100)
  kota_area          String             @db.VarChar(50)
  jabatan            jabatan_agent_enum? @default(AGENT)
  id_upline          String?            @db.VarChar(20)
  rating             Decimal?           @default(0.00) @db.Decimal(3, 2)
  jumlah_closing     Int?               @default(0)
  total_omset        Decimal?           @default(0) @db.Decimal(18, 2)
  nomor_whatsapp     String             @db.VarChar(20)
  foto_ktp_url       String?
  foto_npwp_url      String?
  nama_bank          String?            @db.VarChar(50)
  nomor_rekening     String?            @db.VarChar(50)
  atas_nama_rekening String?            @db.VarChar(100)
  link_instagram     String?            @db.VarChar(100)
  link_tiktok        String?            @db.VarChar(100)
  status_keanggotaan status_agent_enum? @default(PENDING)
  tanggal_gabung     DateTime?          @default(dbgenerated("CURRENT_DATE")) @db.Date
  diperbarui_pada    DateTime?          @default(now()) @db.Timestamp(6)
  
  // RELASI
  pengguna           Pengguna           @relation(fields: [id_pengguna], references: [id_pengguna], onDelete: Cascade, onUpdate: NoAction)
  upline             agent?             @relation("agentToagent", fields: [id_upline], references: [id_agent], onUpdate: NoAction)
  downlines          agent[]            @relation("agentToagent")
  property           property[]

  @@index([jabatan], map: "idx_agent_jabatan")
  @@index([nama_kantor], map: "idx_agent_kantor")
}

// === MODEL PROPERTY ===
model property {
  id_property        String                 @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  id_agent           String                 @db.VarChar(20) // Harus match tipe data ID agent
  
  kode_properti      String                 @unique @default(dbgenerated("('LST'::text || lpad((nextval('property_code_seq'::regclass))::text, 5, '0'::text))")) @db.VarChar(20)
  judul              String                 @db.VarChar(255)
  slug               String                 @unique @db.VarChar(300)
  deskripsi          String?
  jenis_transaksi    jenis_transaksi_enum
  kategori           kategori_properti_enum
  status_tayang      status_properti_enum?  @default(TERSEDIA)
  harga              Decimal                @db.Decimal(18, 2)
  harga_promo        Decimal?               @db.Decimal(18, 2)
  tanggal_lelang     DateTime?              @db.Timestamp(6)
  uang_jaminan       Decimal?               @db.Decimal(18, 2)
  nilai_limit_lelang Decimal?               @db.Decimal(18, 2)
  link               String?                @db.VarChar(500)
  alamat_lengkap     String?                @db.VarChar(500)
  area_lokasi        String?                @db.VarChar(100)
  provinsi           String?                @db.VarChar(100)
  kota               String                 @db.VarChar(100)
  kecamatan          String?                @db.VarChar(100)
  kelurahan          String?                @db.VarChar(100)
  latitude           Decimal?               @db.Decimal(10, 8)
  longitude          Decimal?               @db.Decimal(11, 8)
  luas_tanah         Decimal?               @db.Decimal(10, 2)
  luas_bangunan      Decimal?               @db.Decimal(10, 2)
  jumlah_lantai      Int?                   @default(1)
  kamar_tidur        Int?
  kamar_mandi        Int?
  daya_listrik       Int?
  sumber_air         String?                @db.VarChar(50)
  hadap_bangunan     String?                @db.VarChar(20)
  kondisi_interior   String?                @db.VarChar(50)
  legalitas          sertifikat_enum?
  gambar_utama_url   String?
  dilihat            Int?                   @default(0)
  is_hot_deal        Boolean?               @default(false)
  tanggal_dibuat     DateTime?              @default(now()) @db.Timestamp(6)
  tanggal_diupdate   DateTime?              @default(now()) @db.Timestamp(6)

  // RELASI
  agent              agent                  @relation(fields: [id_agent], references: [id_agent], onDelete: Cascade)

  @@index([id_agent], map: "idx_property_agent")
  @@index([jenis_transaksi], map: "idx_property_jenis")
  @@index([kota], map: "idx_property_lokasi")
  @@index([slug], map: "idx_property_slug")
}

// === ENUMS (Sama seperti SQL) ===
enum peran_enum {
  USER
  AGENT
}

enum status_akun_enum {
  AKTIF
  NONAKTIF
  DIBEKUKAN
}

enum gender_enum {
  LAKI_LAKI
  PEREMPUAN
}

enum jabatan_agent_enum {
  PRINCIPAL
  STOKER
  HOM
  ADMIN
  OWNER
  AGENT
  TEAMLEADER
}

enum jenis_transaksi_enum {
  PRIMARY
  SECONDARY
  LELANG
  SEWA
}

enum kategori_properti_enum {
  RUMAH
  APARTEMEN
  RUKO
  TANAH
  GUDANG
  HOTEL_DAN_VILLA
  TOKO
  PABRIK
}

enum sertifikat_enum {
  SHM
  HGB
  HGU
  HP
  STRATA_TITLE
  PPJB
  AJB
  LAINNYA
}

enum status_agent_enum {
  PENDING
  ACTIVE
  SUSPENDED
  RESIGNED
}

enum status_properti_enum {
  TERSEDIA
  TERJUAL
  TARIK_LISTING
}