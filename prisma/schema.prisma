generator client {
  provider = "prisma-client-js"
  // HAPUS BARIS 'output'. JANGAN ADA APAPUN DISINI.
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Pengguna {
  id_pengguna      String            @id @default(dbgenerated("uuid_generate_v4()")) @db.Uuid
  nama_lengkap     String            @db.VarChar(100)
  email            String?           @unique @db.VarChar(150)
  nomor_telepon    String?           @unique @db.VarChar(20)
  kata_sandi       String            @db.VarChar(255)
  kota_asal        String?           @db.VarChar(50)
  tanggal_lahir    DateTime?         @db.Date
  pekerjaan        pekerjaan_enum?
  jenis_kelamin    gender_enum?
  foto_profil_url  String?
  total_poin       Int?              @default(0)
  peran            peran_enum?       @default(penyewa)
  status_akun      status_akun_enum? @default(aktif)
  wa_terverifikasi Boolean?          @default(false)
  login_terakhir   DateTime?         @db.Timestamp(6)
  dibuat_pada      DateTime?         @default(now()) @db.Timestamp(6)
  diperbarui_pada  DateTime?         @default(now()) @updatedAt @db.Timestamp(6)
// Field Baru
  kode_referral     String?          @unique @db.VarChar(20)
  direferensikan_oleh String?        @db.Uuid // ID Upline
  
  // Relasi Self-Relation (Optional, biar bisa query siapa mengajak siapa)
  upline              Pengguna?        @relation("ReferralHistory", fields: [direferensikan_oleh], references: [id_pengguna])
  downlines           Pengguna[]       @relation("ReferralHistory")
  @@map("pengguna")
}

enum gender_enum {
  pria
  wanita
}

enum pekerjaan_enum {
  mahasiswa
  karyawan
  wiraswasta
  keluarga
  lainnya
}

enum peran_enum {
  super_admin
  admin_kosku
  pemilik
  pengelola
  penyewa
}

enum status_akun_enum {
  aktif
  nonaktif
  dibekukan
}
